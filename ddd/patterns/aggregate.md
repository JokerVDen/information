## Паттерн "Агрегат" (Aggregate)

Паттерн "Агрегат" является ключевым элементом в Domain-Driven Design (DDD). Он используется для организации группы
связанных объектов, которые образуют единое целое и управляются через корневой объект, называемый "Корень агрегата" (
Aggregate Root).

### Особенности агрегатов:

- **Корень агрегата**: В каждом агрегате есть один объект, который является корнем агрегата. Этот объект предоставляет
  точку входа для работы с агрегатом.

- **Границы агрегата**: Все объекты в агрегате должны ссылаться только на корень агрегата. Это ограничивает прямое
  взаимодействие с внутренними объектами агрегата извне.

- **Целостность данных**: Агрегат обеспечивает целостность данных в своем контексте. Все изменения внутри агрегата
  должны происходить атомарно.

### Примеры агрегатов:

- **Заказ и его позиции**: Заказ может содержать в себе позиции, представляющие отдельные элементы заказа. Корнем
  агрегата является сам заказ, а его позиции могут быть изменены только через заказ.

- **Клиент и его контактные данные**: Клиент может иметь контактные данные, такие как адрес электронной почты и номер
  телефона. Корень агрегата - клиент, а его контактные данные должны быть доступны только через клиента.

### Преимущества использования паттерна "Агрегат":

- **Упрощение моделирования**: Агрегаты позволяют разбить сложные объекты на более мелкие части, что делает модель
  предметной области более понятной и управляемой.

- **Целостность данных**: Паттерн "Агрегат" обеспечивает целостность данных внутри своего контекста, что уменьшает
  вероятность возникновения инконсистентности.

- **Улучшенная производительность**: Благодаря ограничению доступа к внутренним объектам агрегата через его корень,
  можно повысить производительность при работе с данными.

### Пример:

Давайте рассмотрим пример агрегата на основе интернет-магазина. Предположим, у нас есть модель заказов с товарами,
которые пользователь добавляет в корзину. В этом контексте "Заказ" может быть агрегатом.

Пусть "Заказ" содержит следующие атрибуты: уникальный идентификатор, дата создания, статус заказа и список товаров в
заказе.

Каждый товар в заказе также может иметь свои атрибуты, такие как идентификатор, название, цена и количество.

В этом примере "Заказ" является корнем агрегата, поскольку заказ контролирует свои товары и предоставляет точку входа
для работы с заказом.

Пример кода на псевдокоде:

```
class Заказ {
    private id: Идентификатор
    private дата_создания: Дата
    private статус: Статус
    private товары: Список<Товар>

    constructor(идентификатор, дата_создания, статус) {
        this.id = идентификатор
        this.дата_создания = дата_создания
        this.статус = статус
        this.товары = []
    }

    добавитьТовар(товар) {
        // Проверка на доступность товара и другие правила бизнес-логики
        this.товары.добавить(товар)
    }

    удалитьТовар(товар) {
        this.товары.удалить(товар)
    }

    изменитьСтатус(новый_статус) {
        this.статус = новый_статус
    }
}

class Товар {
    private id: Идентификатор
    private название: Строка
    private цена: Денежная_сумма
    private количество: Число

    constructor(идентификатор, название, цена, количество) {
        this.id = идентификатор
        this.название = название
        this.цена = цена
        this.количество = количество
    }
}
```

В этом примере "Заказ" является корнем агрегата, так как он контролирует все операции с товарами внутри заказа. Каждый "
Товар" принадлежит определенному заказу и не может существовать сам по себе без него. Таким образом, "Заказ" и его
составляющие "Товары" формируют агрегатную структуру.

[К паттернам DDD](main.md)

[На главную DDD](../main.md)